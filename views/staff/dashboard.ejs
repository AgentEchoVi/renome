<%
  const L = lang === 'ru' ? {
    online: 'Онлайн',
    connecting: 'Подключение...',
    logout: 'Выйти',
    ordersToday: 'заказов сегодня',
    revenue: 'выручка',
    waiting: 'Ожидание новых заказов...',
    willNotify: 'Вы получите уведомление',
    delivery: 'Доставка',
    pickup: 'Самовывоз',
    cash: 'Наличные',
    card: 'Карта',
    total: 'Итого',
    enableNotif: 'Включите уведомления, чтобы не пропустить заказы',
    enable: 'Включить',
    later: 'Позже'
  } : {
    online: 'Online',
    connecting: 'Conectare...',
    logout: 'Ieșire',
    ordersToday: 'comenzi azi',
    revenue: 'venit',
    waiting: 'Așteptarea comenzilor noi...',
    willNotify: 'Veți primi o notificare',
    delivery: 'Livrare',
    pickup: 'Ridicare',
    cash: 'Numerar',
    card: 'Card',
    total: 'Total',
    enableNotif: 'Activați notificările pentru a nu rata comenzile',
    enable: 'Activați',
    later: 'Mai târziu'
  };
%>
<!DOCTYPE html>
<html lang="<%= lang %>">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#0D0D0D">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Staff — Renome</title>
  <link rel="manifest" href="/manifest-staff.json">
  <link rel="icon" href="/img/logo.png">
  <link rel="apple-touch-icon" href="/img/logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/staff.css">
</head>
<body class="staff-body">

  <!-- Top bar -->
  <header class="staff-topbar">
    <div class="staff-topbar__left">
      <span class="staff-topbar__logo">RENOME</span>
      <span class="staff-topbar__label">Staff</span>
    </div>
    <div class="staff-topbar__right">
      <div class="staff-lang">
        <a href="/set-lang?lang=ro&redirect=/staff" class="staff-lang__btn<%= lang === 'ro' ? ' staff-lang__btn--active' : '' %>">RO</a>
        <a href="/set-lang?lang=ru&redirect=/staff" class="staff-lang__btn<%= lang === 'ru' ? ' staff-lang__btn--active' : '' %>">RU</a>
      </div>
      <span class="staff-status" id="sseStatus">
        <span class="staff-status__dot"></span>
        <span class="staff-status__text"><%= L.connecting %></span>
      </span>
      <a href="/staff/logout" class="staff-topbar__logout"><%= L.logout %></a>
    </div>
  </header>

  <!-- Stats -->
  <div class="staff-stats">
    <div class="staff-stats__item">
      <span class="staff-stats__value" id="orderCount"><%= orders.length %></span>
      <span class="staff-stats__label"><%= L.ordersToday %></span>
    </div>
    <div class="staff-stats__item">
      <span class="staff-stats__value" id="orderTotal"><%= orders.reduce((s, o) => s + o.total, 0) %> MDL</span>
      <span class="staff-stats__label"><%= L.revenue %></span>
    </div>
  </div>

  <!-- Orders -->
  <main class="staff-orders" id="ordersContainer">

    <% if (orders.length === 0) { %>
      <div class="staff-empty" id="emptyState">
        <div class="staff-empty__icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
          </svg>
        </div>
        <p class="staff-empty__text"><%= L.waiting %></p>
        <p class="staff-empty__sub"><%= L.willNotify %></p>
      </div>
    <% } %>

    <% orders.forEach(order => { %>
      <div class="staff-order-card" data-order-id="<%= order.id %>">
        <div class="staff-order-card__header">
          <span class="staff-order-card__id">#<%= order.id %></span>
          <span class="staff-order-card__time"><%= new Date(order.created_at).toLocaleTimeString('ru-RU', {hour:'2-digit', minute:'2-digit'}) %></span>
        </div>

        <div class="staff-order-card__customer">
          <div>
            <div class="staff-order-card__name"><%= order.customer_name %></div>
            <% if (order.customer_email) { %>
              <div class="staff-order-card__email"><%= order.customer_email %></div>
            <% } %>
          </div>
          <a href="tel:<%= order.customer_phone %>" class="staff-order-card__phone"><%= order.customer_phone %></a>
        </div>

        <div class="staff-order-card__type">
          <span class="staff-badge staff-badge--<%= order.delivery_type %>">
            <%= order.delivery_type === 'delivery' ? L.delivery : L.pickup %>
          </span>
          <span class="staff-badge staff-badge--payment">
            <%= order.payment_method === 'cash' ? L.cash : L.card %>
          </span>
        </div>

        <% if (order.delivery_address) { %>
          <div class="staff-order-card__address">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
            <%= order.delivery_address %>
          </div>
        <% } %>

        <div class="staff-order-card__items">
          <% order.items.forEach(item => { %>
            <div class="staff-item-row">
              <span class="staff-item-row__qty"><%= item.quantity %>x</span>
              <span class="staff-item-row__name"><%= item.name %></span>
              <span class="staff-item-row__price"><%= item.price * item.quantity %> MDL</span>
            </div>
          <% }) %>
        </div>

        <% if (order.comment) { %>
          <div class="staff-order-card__comment">"<%= order.comment %>"</div>
        <% } %>

        <div class="staff-order-card__total">
          <span><%= L.total %></span>
          <span><%= order.total %> MDL</span>
        </div>
      </div>
    <% }) %>

  </main>

  <!-- Notification permission banner -->
  <div class="staff-notify-banner" id="notifyBanner" style="display:none">
    <span><%= L.enableNotif %></span>
    <button class="staff-notify-btn" id="enableNotifyBtn"><%= L.enable %></button>
    <button class="staff-notify-dismiss" id="dismissNotifyBtn"><%= L.later %></button>
  </div>

  <script>
    window.STAFF_LANG = '<%= lang %>';
  </script>
  <script src="/js/staff.js"></script>
</body>
</html>
